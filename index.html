<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>What It's Like</title>
        <meta name="viewport" content="width=device-width">
        
        <script src="js/sugar-1.3.9.min.js"></script>
        <script src='http://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.js'></script>
        <script src="js/main.js"></script>

        <link href='http://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.css' rel='stylesheet' />
        <link rel="stylesheet" href="css/main.css">
    </head>
    <body>
        <div id='map'></div>
        <script src='http://d3js.org/d3.v2.min.js'></script>
        <script>
            function d3layer() {
                var f = {}, bounds, feature, collection;
                var div = d3.select(document.body)
                    .append("div")
                    .attr('class', 'd3-vec'),
                    svg = div.append('svg'),
                    g = svg.append("g");

                f.parent = div.node();

                f.project = function(x) {
                  var point = f.map.locationPoint({ lat: x[1], lon: x[0] });
                  return [point.x, point.y];
                };

                var first = true;
                f.draw = function() {
                  first && svg.attr("width", f.map.dimensions.x)
                      .attr("height", f.map.dimensions.y)
                      .style("margin-left", "0px")
                      .style("margin-top", "0px") && (first = false);

                  path = d3.geo.path().projection(f.project);
                  feature.attr("d", path);
                };

                f.data = function(x) {
                    collection = x;
                    bounds = d3.geo.bounds(collection);
                    feature = g.selectAll("path")
                        .data(collection.features)
                        .enter().append("path");
                    return f;
                };

                f.extent = function() {
                    return new MM.Extent(
                        new MM.Location(bounds[0][1], bounds[0][0]),
                        new MM.Location(bounds[1][1], bounds[1][0]));
                };
                return f;
            }
            var new_jersey = {"type":"FeatureCollection","features":[
              {"type":"Feature","id":"34","properties":{"name":"New Jersey"},"geometry":{"type":"Polygon","coordinates":[[[-74.236547,41.14083],[-73.902454,40.998429],[-74.022947,40.708151],[-74.187255,40.642428],[-74.274886,40.489074],[-74.001039,40.412397],[-73.979131,40.297381],[-74.099624,39.760641],[-74.411809,39.360824],[-74.614456,39.245808],[-74.795195,38.993869],[-74.888303,39.158177],[-75.178581,39.240331],[-75.534582,39.459409],[-75.55649,39.607286],[-75.561967,39.629194],[-75.507197,39.683964],[-75.414089,39.804456],[-75.145719,39.88661],[-75.129289,39.963288],[-74.82258,40.127596],[-74.773287,40.215227],[-75.058088,40.417874],[-75.069042,40.543843],[-75.195012,40.576705],[-75.205966,40.691721],[-75.052611,40.866983],[-75.134765,40.971045],[-74.882826,41.179168],[-74.828057,41.288707],[-74.69661,41.359907],[-74.236547,41.14083]]]}},
            ]};
            var canada = {
			   "type":"FeatureCollection",
			   "features":[
				  {
					 "type":"Feature",
					 "id":"35",
					 "properties":{
						"name":"Canada 1"
					 },
					 "geometry":{
						"type":"Polygon",
						"coordinates":[[[-134.242980870292058,69.576583917509623],[-134.230834964519602,68.699722322598603],[-135.999573009553728,68.945877093197566],[-134.242980870292058,69.576583917509623]]]
					 }
				  },
				  {
					 "type":"Feature",
					 "id":"35",
					 "properties":{
						"name":"Canada 2"
					 },
					 "geometry":{
						"type":"Polygon",
						"coordinates":[[[-72.336395224560604,83.097763086257146],[-61.076393192740696,82.320831370905239],[-69.297210714263656,81.714569143469276],[-66.62311555392543,81.513809218240596],[-70.208198532287298,81.176788364235449],[-64.44394682363226,81.481994665352602],[-72.416671770741232,80.209159785159585],[-70.503822306409219,80.093810908544526],[-71.183883545245806,79.777480849602426],[-78.051315225266819,79.350814786681156],[-74.442840601470564,79.059074365067829],[-78.88541417739178,79.061782784297719],[-74.723472578996052,78.704437256760542],[-78.690551801152367,77.315536570627501],[-81.927009809194601,77.683586048368682],[-77.784446953029061,76.78651436892406],[-81.053329423144447,76.128036522402454],[-82.725006009999206,76.819152871276884],[-82.131591831983428,76.445121707002301],[-89.672638019555208,76.566925059781738],[-86.739990298273028,77.174148356236685],[-88.068069397101269,77.82026678476609],[-84.479446481186116,77.294433536802046],[-82.325210627157063,78.072692794743944],[-83.89834595597118,77.490539494107253],[-85.673538125129696,77.938590926880806],[-84.127220142344783,78.175537036894156],[-84.970001279334539,78.210823055568341],[-84.62596884596995,78.5892867546481],[-87.532363893276582,78.140609746912389],[-86.856948877484925,78.734985345987099],[-81.484023879027021,79.045745781138152],[-84.748046789897671,79.031936662698968],[-83.371734523733707,79.047759977618796],[-86.514724697239771,80.299148585051],[-79.898612917724918,79.648048439419853],[-83.197219879641963,80.314704877681123],[-78.038055465144183,80.567215025203097],[-79.960418632664371,80.6113662895076],[-76.511672975744588,80.854431205608535],[-78.935691816642446,80.878448426005093],[-76.762710540223921,81.437927186552315],[-85.066955541354076,80.505264093790998],[-86.738952836588425,80.603317248463583],[-82.368331822615573,81.177062955383747],[-87.594726535391146,80.628585794804479],[-89.454444900789923,80.910018839199097],[-84.737289505643702,81.284286574309135],[-89.820846479601471,81.010818433414386],[-90.351943956714038,81.167480428388529],[-87.248062075462272,81.488876341976493],[-91.953048682240365,81.660400406831485],[-84.613464387525056,81.888458212598835],[-86.868461639436603,82.197479218437508],[-85.046951224161702,82.481933645563089],[-79.236808821889767,81.816085843029526],[-82.728675850288013,82.398391752977432],[-72.336395224560604,83.097763086257146]]]
					 }
				  }

			   ]
			};

          mapbox.load('jneiku.map-ayx760yj', function(o){
            var map = mapbox.map('map');
            map.addLayer(o.layer);
            map.interaction.auto();

            l = d3layer().data(canada);
            map.addLayer(l);
            map.extent(l.extent());
            
        	l = d3layer().data(new_jersey);
            map.addLayer(l);
            map.extent(l.extent());
            
          });
        </script>
    </body>
</html>